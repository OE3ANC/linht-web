<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linht Manager</title>
    <!-- xterm.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- Main Application -->
    <div id="app" class="screen">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <span class="prompt-symbol">&gt;</span><span class="logo-text">LinHT</span><span class="cursor">_</span>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="terminal">Terminal</button>
                <button class="nav-tab" data-tab="files">Files</button>
                <button class="nav-tab" data-tab="services">Services</button>
                <button class="nav-tab" data-tab="hardware">Hardware</button>
                <button class="nav-tab" data-tab="cps">Settings</button>
            </div>
        </nav>

        <!-- Hardware Tab -->
        <div id="hardware-tab" class="tab-content hidden">
            <div class="toolbar">
                <h2>SX1255 Hardware Control</h2>
                <div class="toolbar-actions">
                    <button id="hw-init-btn" class="btn btn-primary">Initialize</button>
                    <button id="hw-reset-btn" class="btn">Reset</button>
                    <button id="hw-close-btn" class="btn btn-danger">Close</button>
                    <button id="hw-refresh-btn" class="btn">⟳ Refresh</button>
                </div>
            </div>

            <!-- Device Status Section -->
            <div class="hw-section">
                <h3 class="hw-section-title">&gt; DEVICE STATUS</h3>
                <div class="hw-status-grid">
                    <div class="hw-status-item">
                        <span class="hw-label">Connection:</span>
                        <span id="hw-conn-status" class="hw-value">Not initialized</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">Version:</span>
                        <span id="hw-version" class="hw-value">--</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">RX Freq:</span>
                        <span id="hw-rx-freq" class="hw-value">-- MHz</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">TX Freq:</span>
                        <span id="hw-tx-freq" class="hw-value">-- MHz</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">RX PLL:</span>
                        <span id="hw-rx-pll" class="hw-value">--</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">TX PLL:</span>
                        <span id="hw-tx-pll" class="hw-value">--</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">XOSC:</span>
                        <span id="hw-xosc" class="hw-value">--</span>
                    </div>
                    <div class="hw-status-item">
                        <span class="hw-label">Mode:</span>
                        <span id="hw-mode" class="hw-value">--</span>
                    </div>
                </div>
            </div>

            <!-- Quick Controls Section -->
            <div class="hw-section">
                <h3 class="hw-section-title">&gt; QUICK CONTROLS</h3>
                <div class="hw-controls-grid">
                    <div class="hw-control-group">
                        <label class="hw-label">Operating Mode:</label>
                        <div class="hw-control-row">
                            <select id="hw-mode-select">
                                <option value="sleep">Sleep</option>
                                <option value="standby">Standby</option>
                                <option value="rx">RX</option>
                                <option value="tx">TX</option>
                                <option value="tx_full">TX Full (with PA)</option>
                                <option value="full_duplex">Full-Duplex (RX+TX+PA)</option>
                            </select>
                            <button id="hw-set-mode-btn" class="btn btn-sm">Set</button>
                        </div>
                    </div>

                    <div class="hw-control-group">
                        <label class="hw-label">RX Frequency (MHz):</label>
                        <div class="hw-control-row">
                            <input type="number" id="hw-rx-freq-input"
                                   value="433.475" step="0.001" min="400" max="510">
                            <button id="hw-set-rx-freq-btn" class="btn btn-sm">Set</button>
                        </div>
                    </div>

                    <div class="hw-control-group">
                        <label class="hw-label">TX Frequency (MHz):</label>
                        <div class="hw-control-row">
                            <input type="number" id="hw-tx-freq-input"
                                   value="438.000" step="0.001" min="400" max="510">
                            <button id="hw-set-tx-freq-btn" class="btn btn-sm">Set</button>
                        </div>
                    </div>

                    <div class="hw-control-group">
                        <label class="hw-label">LNA Gain (dB):</label>
                        <div class="hw-control-row">
                            <input type="number" id="hw-lna-gain-input"
                                   value="48" min="0" max="48" step="6">
                            <button id="hw-set-lna-gain-btn" class="btn btn-sm">Set</button>
                        </div>
                    </div>

                    <div class="hw-control-group">
                        <label class="hw-label">PGA Gain (dB):</label>
                        <div class="hw-control-row">
                            <input type="number" id="hw-pga-gain-input"
                                   value="30" min="0" max="30" step="2">
                            <button id="hw-set-pga-gain-btn" class="btn btn-sm">Set</button>
                        </div>
                    </div>

                    <div class="hw-control-group">
                        <label class="hw-label">TX/RX Switch:</label>
                        <div class="hw-control-row">
                            <button id="hw-txrx-rx-btn" class="btn btn-sm">RX</button>
                            <button id="hw-txrx-tx-btn" class="btn btn-sm">TX</button>
                            <span id="hw-txrx-status" class="hw-value">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Register Viewer Section -->
            <div class="hw-section">
                <h3 class="hw-section-title">&gt; REGISTER VIEWER</h3>
                <div class="hw-register-controls">
                    <button id="hw-read-all-regs-btn" class="btn btn-sm">Read All</button>
                </div>
                <div class="hw-register-table-container">
                    <table class="data-table hw-register-table">
                        <thead>
                            <tr>
                                <th>Addr</th>
                                <th>Name</th>
                                <th>Hex</th>
                                <th>Binary</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="hw-register-list">
                            <tr><td colspan="5" class="loading">Click "Read All" to view registers</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Images Tab -->
        <div id="images-tab" class="tab-content hidden">
            <div class="toolbar">
                <h2>Docker Images</h2>
                <div class="toolbar-actions">
                    <label for="import-file" class="btn btn-primary">
                        Import Image
                        <input type="file" id="import-file" accept=".tar,.tar.gz,.tgz" hidden>
                    </label>
                    <button id="refresh-images" class="btn">Refresh</button>
                </div>
            </div>

            <div id="images-list" class="list-container">
                <div class="loading">Loading images...</div>
            </div>
        </div>

        <!-- Containers Tab -->
        <div id="containers-tab" class="tab-content hidden">
            <div class="toolbar">
                <h2>Docker Containers</h2>
                <div class="toolbar-actions">
                    <button id="create-container-btn" class="btn btn-primary">Create Container</button>
                    <button id="refresh-containers" class="btn">Refresh</button>
                </div>
            </div>

            <div id="containers-list" class="list-container">
                <div class="loading">Loading containers...</div>
            </div>
        </div>

        <!-- Files Tab -->
        <div id="files-tab" class="tab-content hidden">
            <div class="toolbar">
                <h2>File Manager</h2>
                <div class="toolbar-actions">
                    <button id="fm-parent-btn" class="btn">↑ Parent</button>
                    <button id="fm-mkdir-btn" class="btn btn-primary">+ Folder</button>
                    <button id="fm-upload-btn" class="btn btn-primary">↑ Upload</button>
                    <input type="file" id="fm-upload-input" hidden>
                    <button id="fm-refresh-btn" class="btn">⟳ Refresh</button>
                </div>
            </div>
            
            <div class="fm-breadcrumb-container">
                <div id="fm-breadcrumb">/</div>
            </div>
            
            <div class="fm-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Size</th>
                            <th>Modified</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="fm-file-list">
                        <tr><td colspan="4" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Terminal Tab -->
        <div id="terminal-tab" class="tab-content active">
            <div class="toolbar">
                <h2>Terminal</h2>
                <div class="toolbar-actions">
                    <button id="new-host-shell" class="btn btn-primary" onclick="openHostShell()">Connect</button>
                    <button id="close-terminal" class="btn btn-danger" onclick="closeTerminal()">Close</button>
                </div>
            </div>
            
            <div id="terminal-container" class="terminal-wrapper">
                <div id="xterm-container"></div>
            </div>
        </div>

        <!-- Services Tab -->
        <div id="services-tab" class="tab-content hidden">
            <div class="toolbar">
                <h2>LinHT Services</h2>
                <div class="toolbar-actions">
                    <button id="services-refresh-btn" class="btn">⟳ Refresh</button>
                </div>
            </div>
            
            <div class="services-table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Enabled</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="services-list">
                        <tr><td colspan="5" class="empty">Click ⟳ Refresh to load services</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- CPS Tab -->
        <div id="cps-tab" class="tab-content hidden">
            <div class="toolbar">
                <h2>Settings</h2>
                <div class="toolbar-actions">
                    <button id="cps-load-btn" class="btn btn-primary">Load</button>
                    <button id="cps-save-btn" class="btn btn-success">Save</button>
                </div>
            </div>
            
            <div id="cps-form-container" class="cps-container">
                <div class="loading">Click "Load" to load settings...</div>
            </div>
        </div>
    </div>

    <!-- Create Container Modal -->
    <div id="create-container-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Container</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="create-container-form">
                <div class="form-group">
                    <label>Image:</label>
                    <select id="container-image" required>
                        <option value="">Select an image...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Container Name:</label>
                    <input type="text" id="container-name" placeholder="Optional">
                </div>
                <div class="form-group">
                    <label>Environment Variables (one per line):</label>
                    <textarea id="container-env" rows="3" placeholder="KEY=value"></textarea>
                </div>
                <div class="form-group">
                    <label>Command (space-separated):</label>
                    <input type="text" id="container-cmd" placeholder="Optional">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeCreateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Logs Modal -->
    <div id="logs-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Container Logs</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="logs-container" id="logs-content"></div>
        </div>
    </div>

    <!-- Container Selection Modal -->
    <div id="container-select-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Container</h3>
                <button class="modal-close" onclick="document.getElementById('container-select-modal').classList.add('hidden')">&times;</button>
            </div>
            <div id="container-select-list"></div>
        </div>
    </div>

    <!-- File Manager Create Folder Modal -->
    <div id="fm-mkdir-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Folder</h3>
                <button class="modal-close fm-modal-close">&times;</button>
            </div>
            <form id="fm-mkdir-form">
                <div class="form-group">
                    <label>Folder Name:</label>
                    <input type="text" id="fm-folder-name" required placeholder="Enter folder name">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn fm-modal-close">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Services Logs Modal -->
    <div id="services-logs-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="services-logs-title">Service Logs</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="logs-container" id="services-logs-content"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-animation">
            <div class="loading-text">
                <span class="prompt-symbol">&gt;</span><span class="logo-text">LinHT</span><span class="cursor">_</span>
            </div>
            <div class="scan-container">
                <div class="scan-bar"></div>
            </div>
            <div class="loading-status" id="loading-status">Communicating with daemon...</div>
        </div>
    </div>

    <!-- xterm.js and addons -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    
    <!-- Application scripts -->
    <script src="/utils.js"></script>
    <script src="/app.js"></script>
    <script src="/filemanager.js"></script>
    <script src="/terminal.js"></script>
    <script src="/hardware.js"></script>
    <script src="/cps.js"></script>
    <script src="/services.js"></script>
</body>
</html>